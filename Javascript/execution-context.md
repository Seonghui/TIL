# 실행 컨텍스트 (실행 문맥)

어떻게 자바스크립트 코드가 실행되는지 이해하기 위해 알아야하는 개념이다.

# 1. 실행 컨텍스트 개념

함수를 호출할 때 해당 함수의 호출 정보(함수 내 지역 변수 혹은 인자값 등)가 차곡차곡 쌓여있는 스택을 콜 스택이라고 한다. C 언어에서는 이러한 콜 스택의 호출 정보 등으로 코드의 실행 과정을 추적하여 디버깅과 같은 작업을 수행한다.  
실행 컨텍스트는 콜 스택에 들어가는 실행 정보와 비슷하다. 실행 컨텍스트는 실행 가능한 코드를 형상화하고 구분하는 추상적인 개념으로, 더 쉽게 말하자면 코드의 실행 환경(코드 덩어리)같은 것이다.  
실행 컨텍스트는 함수가 실행될 때 생성된다.

# 2. 예시

1. 함수가 호출되면 함수의 실행 컨텍스트가 생성됨
2. 실질적으로는 함수 내부 정보를 담는 객체가 생성되고, 그 객체에는 함수 정보가 담김.(변수명, 함수명 등이 프로퍼티로 생성됨. )

```javascript
console.log("This is global context");

function context1() {
  console.log("This is context1");
}

function context2() {
  context1();
  console.log("This is context2");
}
```

# 3. 실행 컨텍스트의 3가지 객체
* Variable Object(변수 객체, 활성 객체)
* 스코프 체인
* this

## 3.1 Variable Object(변수 객체, 활성 객체)
변수 객체에는 아래와 같은 정보를 담을 수 있다.
* 변수
* 매개변수(parameter)와 인자(argument)
* 함수 선언 (함수 표현식은 제외)
실행 컨텍스트가 생성되면 자바스크립트 엔진은 해당 컨텍스트에서 실행에 필요한 여러 가지 정보를 담을 객체를 생성하는데, 이를 활성 객체라고 한다.  
이 객체에 앞으로 사용하게 될 매개변수나 사용자가 정의한 변수 및 객체를 저장하고, 새로 만들어진 컨텍스트로 접근 가능하게 되어있다.

# 3.2 Scope Chain(스코프 체인)
일종의 리스트. 중첩된 함수의 스코프 레퍼런스를 차례대로 저장하고 있는 개념이다. 전역 객체 또는 활성 객체의 리스트를 가리킨다. 현재 실행 컨텍스트의 활성 객체를 선두로 하여 상위 컨텍스트의 활성 객체를 가리키며 마지막 리스트는 전역 객체를 가리킨다.  
(엔진은 스코프 체인을 통해서 변수의 스코프를 파악한다. 함수가 중첩 상태일 때 하위함수 내에서 상휘함수의 유효 범위까지 참조할 수 있는데 이는 스코프 체인을 검색했기 때문이다.)

## 3.3 this
`this` 프로퍼티에는 this 값이 할당된다. `this에 할당되는 값은 this 바인딩의 호출 패턴에 의해 결정된다.


# 4. 실행 컨텍스트 생성 과정
1. 활성 객체 생성 (공간 생성)
2. arguments 객체 생성
3. 스코프 정보 생성
4. 변수 생성
5. this 바인딩
6. 코드 실행
쉽게 말해서 함수가 호출되면 함수의 실행 컨텍스트가 생성된다. 실질적으로는 함수 내부 정보를 담는 객체가 생성되고, 그 안에는 함수 정보가 담긴다. 이후 코드가 생성된다.

## 4.1 활성 객체 생성


## 4.2 arguments 객체 생성
arguments 프로퍼티는 arguments 객체를 참조한다.

## 4.3 스코프 정보 생성
현재 컨텍스트의 유효 범위를 나타내는 스코프 정보를 생성한다. 이 스코프 정보는 현재 실행 중인 실행 컨텍스트 안에서 연결 리스트와 유사한 형식으로 만들어진다. 현재 컨텍스트에서 특정 변수에 접근해야 할 경우 이 리스트를 활용한다. 이 리스트에서 찾지 못한 변수는 결국 정의되지 않은 변수에 접근하는 것으로 판단하여 에러를 검출한다. 이 리스트를 스코프 체인이라고 한다.  (현재 생성된 활성 객체가 스코프 체인의 제일 앞에 추가된다.)

## 4.4 변수 생성
현재 실행 컨텍스트 내부에서 사용되는 지역 변수의 생성이 이루어진다. (활성 객체 = 변수 객체) 변수 객체 안에서 호출된 함수 인자는 각각의 프로퍼티가 만들어지고 그 값이 할당된다. 하지만 변수나 내부 함수를 단지 메모리에 생성하고, 초기화는 변수나 함수에 해당하는 표현식이 실행되기 전까지는 이루어지지 않는다.

## 4.5 this 바인딩
this 키워드를 사용하는 값이 할당된다. 여기서 this가 참조하는 객체가 없으면 전역 객체를 참조한다.

## 4.6 코드 실행
이렇게 하나의 실행 컨텍스트가 생성되고, 변수 객체가 만들어진 후에 코드에 있는 여러 가지 표현식 실행이 이루어진다. 이렇게 실행되면서 변수의 초기화 및 연산, 또 다른 함수 실행등이 이루어진다. 그리고 3.4에서 생성했던 변수에도 값이 할당된다. 

# 5. 전역 실행 컨텍스트와 일반적인 실행 컨텍스트
참고로 전역 실행 컨텍스트는 일반적인 실행 컨텍스트와는 약간 다르다. arguments 객체가 없으며 전역 객체 하나만을 포함하는 스코프 체인이 있다.